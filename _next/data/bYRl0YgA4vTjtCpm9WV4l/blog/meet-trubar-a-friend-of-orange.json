{"pageProps":{"frontmatter":{"author":"Janez Demšar","date":"2023-01-17","draft":false,"title":"Meet Trubar, a friend of Orange","thumbImage":"2023-01-20-trubar-brez.png","frontPageImage":"2023-01-20-trubar-brez.png","blog":["development"],"shortExcerpt":"A new, general utility for localization of Python software","longExcerpt":"A new, general utility for localization of Python software, developed for Orange","oldUrl":"/blog/2023/2023-01-17-trubar/"},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    a: \"a\",\n    code: \"code\",\n    pre: \"pre\",\n    span: \"span\",\n    em: \"em\"\n  }, _provideComponents(), props.components), {WindowScreenshot} = _components;\n  if (!WindowScreenshot) _missingMdxReference(\"WindowScreenshot\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Orange has been translated to Slovenian language (no official release yet: rough corners are very much being polished). This will pave the way for translations into other languages.\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2023-01-trubar/2023-01-17-table.png\",\n      width: \"1096\",\n      height: \"1016\",\n      src: \"/blog/2023-01-trubar/__webp-images__/2023-01-17-table.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"What do we use? Gettext, right? Wrong. Orange is written in modern Python and uses f-strings for string interpolation. They are great, but don't play well with gettext.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Why gettext doesn't cut it\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you've never heard about gettext: \", _jsx(_components.a, {\n        href: \"https://www.gnu.org/software/gettext/\",\n        children: \"gettext\"\n      }), \" is a popular framework for software localization. Developers enclose every string that needs to be translated into a function call that translates it. The function would be called something short, like \", _jsx(_components.code, {\n        children: \"_\"\n      }), \" or \", _jsx(_components.code, {\n        children: \"tr\"\n      }), \". One of gettext's utilities extracts all such strings into messages files. Translators provide translations. Messages are compiled into binary form and imported into the program. When function \", _jsx(_components.code, {\n        children: \"_\"\n      }), \" (or \", _jsx(_components.code, {\n        children: \"tr\"\n      }), \" or whatever) gets a string, it searches for a translation and returns it.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So in Python, a programmer would write \", _jsx(_components.code, {\n        children: \"print(tr(\\\"Data contains {n} instances\\\").format(n)))\"\n      }), \". Translator would see the message \", _jsx(_components.code, {\n        children: \"\\\"Data contains {n} instances\\\"\"\n      }), \" and provide a translation, for instance \", _jsx(_components.code, {\n        children: \"\\\"Podatki vsebujejo {n} primerov.\\\"\"\n      }), \". After messages are compiled and in their place, the function \", _jsx(_components.code, {\n        children: \"tr\"\n      }), \" would receive the English message and return the Slovenian translation.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The above example uses the old-style interpolation with \", _jsx(_components.code, {\n        children: \"format\"\n      }), \". is does not work for Python's f-strings. With f-strings, we would have \", _jsx(_components.code, {\n        children: \"print(tr(f\\\"Data contains {n} instances\\\")\"\n      }), \". The number, \", _jsx(_components.code, {\n        children: \"n\"\n      }), \", is interpolated before the function call, so \", _jsx(_components.code, {\n        children: \"tr\"\n      }), \" already receives the entire string, like \", _jsx(_components.code, {\n        children: \"\\\"Data contains 1234 instances\\\"\"\n      }), \". This obviously doesn't match any pre-translated messages, because it includes a specific number. Call \", _jsx(_components.code, {\n        children: \"tr\"\n      }), \" earlier? See, that's the thing: you can't. There is no such string as \", _jsx(_components.code, {\n        children: \"\\\"Data contains {n} instances\\\"\"\n      }), \". It is never \\\"materialized\\\": in Python's abstract syntax tree, these are three distinct elements (a constant \", _jsx(_components.code, {\n        children: \"\\\"Data contains \\\"\"\n      }), \", expression \", _jsx(_components.code, {\n        children: \"n\"\n      }), \", and a constant \", _jsx(_components.code, {\n        children: \" instance\"\n      }), \"). At the moment they are joined into an actual object (of type \", _jsx(_components.code, {\n        children: \"str\"\n      }), \") that can be passed to some function, the value of \", _jsx(_components.code, {\n        children: \"n\"\n      }), \" is already interpolated.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Gettext-like approaches thus can't work on f-strings. To our knowledge, there is currently no tool to support translation of f-strings.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Luckily, we are programmers.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Enters Trubar\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We developed Trubar. Named after Primož Trubar (the author of the first Slovenian printed books, Catechismus and Abecedarium, and the first translator of part of the Bible in Slovenian language), Trubar collects all strings from sources and places them into a yaml-like file. There, they can be translated - or marked as strings that must not be translated. Then, Trubar copies the sources, substituting strings with their translations, if provided.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is a part of the file related to the translation of the Table widget above.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-yaml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"widgets/data/owtable.py:\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"class\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`OWDataTable`:\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Data Table:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Tabela\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"icons/Table.svg:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"class\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`Inputs`:\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Data:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Podatki\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"class\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`Outputs`:\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Selected Data:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Izbor\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"podatkov\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`__init__`:\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Variables:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Spremenljivke\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"show_attribute_labels:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Show\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"variable\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"labels\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"(if\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"present):\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Pokaži\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"oznake\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"spremenljivk\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"show_distributions:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Visualize numeric values:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Vizualiziraj\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"številske\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"vrednosti\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"color_by_class:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Color by instance classes:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Obarvaj\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"primere\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"glede\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"na\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"razred\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Selection:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Izbor\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"select_rows:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Select full rows:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Izbiraj\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"cele\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"vrstice\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Restore Original Order:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Izvirni\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"vrstni\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"red\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`set_dataset`:\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"Data:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Podatki\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If it looks simple, it's because \", _jsxs(_components.a, {\n        href: \"http://janezd.github.io/trubar/getting-started/\",\n        children: [\"it \", _jsx(_components.em, {\n          children: \"is\"\n        }), \" simple\"]\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Besides working with f-strings, the advantage of Trubar's approach is that - unlike gettext - it does not pollute the sources with calls and parentheses. There's enough of them already. Instead of marking strings for translation within the source code, they are marked (for non-translation) in the message file. This must be done at some point, but it's better to do it in a dedicated place, not in the code.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This of course comes at a cost: unlike with gettext where the user can switch between languages, software translated with Trubar requires a separate distribution for each language. Or packing separate sources for multiple languages into one distribution. Whether this hurts or not, depends upon circumstances.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"What about plural forms?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"You ask that seriously? So you don't speak Slovenian, I guess.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"See the text \\\"Ni ciljne spremenljivke\\\" in the screenshot? It means \\\"No target variable\\\". Slovenian language counts like this:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        children: \"Ni ciljne spremenljivke\\nEna ciljna spremenljivka\\nDve ciljni spremenljivki\\nTri ciljne spremenljivke\\nŠtiri ciljne spremenljivke\\nPet ciljnih spremenljivk\\n...\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"and then the same form is used until 101, where we go back to singular, dual, plural, plural and genitive (which is what you see above).\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Developed by native speaker of this beautifully complicated Slavic language, Trubar handles it with excellence. The beauty of f-strings is that they make implementation of plural forms much simpler because they allow using arbitrary functions. We simply inserted the appropriate function call and that's it. For instances, besides having four plural forms, the translation of proposition \\\"with\\\" before a number depends upon the number, and this is handled simply by using the function that returns the proper former for the given number. Which all happens without any help in the original source.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"More about localization in \", _jsx(_components.a, {\n        href: \"http://janezd.github.io/trubar/localization/\",\n        children: \"documentation\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Ready to use?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Sure, try it out. Trubar is \", _jsx(_components.a, {\n        href: \"https://pypi.org/project/trubar/\",\n        children: \"pip-installable\"\n      }), \", \", _jsx(_components.a, {\n        href: \"http://janezd.github.io/trubar/\",\n        children: \"documentation\"\n      }), \" is decent enough and although it is still early in development, we don't plan any huge changes. The least we can promise is that its compatibility-breaking changes will give you less headache that those by pyqtgraph. (Though ... this may not be much of a promise. :)\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"thumbImage":{"width":1080,"height":720,"src":"/blog/2023-01-trubar/__webp-images__/2023-01-20-trubar-brez.webp"}},"__N_SSG":true}