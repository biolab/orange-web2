{"pageProps":{"frontmatter":{"author":"Primo≈æ Godec","date":"2022-02-11","draft":false,"title":"Editing the photographs collection with the help of machine learning","type":"blog","thumbImage":"2022-02-11-grid-title.jpg","frontPageImage":"2022-02-11-grid-title.jpg","blog":["orange","image analytics","images","machine learning"],"shortExcerpt":"How to use Orange's image embedding to identify similar images, classify them in categories and make an order in your photographs collection?","longExcerpt":"The core element of Orange's image analysis is embedding images in the vector space, which just became a feaster with our infrastructure upgrades. We use this opportunity to show possible ways of analyzing images through observing similar images and classifying them.","x2images":false},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h3: \"h3\",\n    a: \"a\",\n    strong: \"strong\",\n    em: \"em\"\n  }, _provideComponents(), props.components), {WindowScreenshot, LinkNew} = _components;\n  if (!LinkNew) _missingMdxReference(\"LinkNew\", true);\n  if (!WindowScreenshot) _missingMdxReference(\"WindowScreenshot\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"The core element of Orange's image analysis is embedding images in the vector space. Last year, we upgraded the embedding server infrastructure, enabling around ten times faster image embedding.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We switched from an old cluster with a fixed number of workers for each embedding to a new infrastructure where workers turn on when needed. It means that when a user sends images to the embedder, it will turn on as many instances as required until processors' cores are available. Inception-v3, VGG16, and VGG19 embedders also perform computation on GPU, making them even faster.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We also made some modifications in the implementation on Orange's part, making embedding more reliable.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"How does embedding work?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/imageembedding/\",\n        children: \"The Image Embedding widget\"\n      }), \" gets the table with images' metadata such as an image name, location and size, but they are not ready for analysis. Images are sent to the server to be embedded in a format understandable to machine learning algorithms. The server pushes images through a pre-trained deep neural network and returns the number vectors to the widget.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-embedding-widget.jpg\",\n      width: \"674\",\n      height: \"552\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-embedding-widget.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Deep neural networks are trained on various specific tasks. \", _jsx(_components.a, {\n        href: \"https://arxiv.org/abs/1512.00567\",\n        children: \"Inception v3\"\n      }), \", \", _jsx(_components.a, {\n        href: \"https://arxiv.org/abs/1409.1556\",\n        children: \"VGG16, VGG19\"\n      }), \" and \", _jsx(_components.a, {\n        href: \"https://arxiv.org/abs/1602.07360\",\n        children: \"SqueezeNet\"\n      }), \" are trained to classify images into 1000 classes according to the object at the image. \", _jsx(_components.a, {\n        href: \"https://www.nature.com/articles/s41467-019-12397-x\",\n        children: \"Painters\"\n      }), \" are trained to predict paintings' authors, \", _jsx(_components.a, {\n        href: \"https://pubmed.ncbi.nlm.nih.gov/29036616/\",\n        children: \"DeepLoc\"\n      }), \" to predict yeast's cells structures and \", _jsx(_components.a, {\n        href: \"https://ieeexplore.ieee.org/document/8373812\",\n        children: \"OpenFace\"\n      }), \" for face recognition. We disregard the classification layer of the network and consider the penultimate layer instead and use that for the image's vector-based representation.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Editing photo collection\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I have taken many photographs in the last few years, but I have not had the time to edit the collection. I want to sort them into subfolders based on the categories. Can machine learning algorithms and image embeddings help me with that?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This blog post will show two approaches for identifying categories and sorting images. The first one is unsupervised, and the second one is supervised.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, we load photos. We load a folder of images with a collection that we would like to sort in the subfolders (\", _jsx(_components.a, {\n        href: \"https://github.com/PrimozGodec/datasets/blob/master/image-analytics-collection/test-photos.zip\",\n        children: \"download dataset\"\n      }), \").\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-inspect-images.jpg\",\n      width: \"700\",\n      height: \"646\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-inspect-images.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Both approaches will include embedding images. We connect the \", _jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/imageembedding/\",\n        children: \"Image Embedding\"\n      }), \" widget to the Import Images widget to embed pictures and select \", _jsx(_components.strong, {\n        children: \"Inception v3 embedder\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.em, {\n        children: \"Our server deletes all images immediately after embedding. If you would not like to share your photos with our server anyway, you can select the SqueezeNet embedder that embeds images at your computer.\"\n      })\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-embedding.jpg\",\n      width: \"700\",\n      height: \"537\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-embedding.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Image Embedding widget added 2048 columns with numbers to each image in the data table. Those numbers describe properties that neural networks inferred from pictures. Numbers are not understandable to humans but make sense to machine learning algorithms.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Image grid will place similar photographs closer on the grid\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/imagegrid/\",\n        children: \"The Image Grid\"\n      }), \" uses \", _jsx(_components.a, {\n        href: \"/widget-catalog/unsupervised/tsne/\",\n        children: \"t-sne embedding\"\n      }), \" to project images on 2-dimensional plane based on their image embeddings. More similar images will be closer in the plot.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We passed embedded images from the Image Embedding to the Image Grid widget.\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-grid.jpg\",\n      width: \"700\",\n      height: \"882\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-grid.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Image Grid has placed similar images closer in the grid. For example, in the top right corner are images of food, in the top left corner are photos of cities, on the right side are pictures of mountains, and at the bottom left are images of sunsets. The Image Grid had more difficulties with snowy photos. Some are placed at the bottom (they seem to include some mountain image elements), and three central ones seem to have elements of cities, mountains and snow.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Since images that belong to the same group are close together, it is easy to mark groups of images manually (colours around images). Marked groups are in the output table as class attributes. We can save them on the computer such that each group is a separate folder with \", _jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/saveimages\",\n        children: \"the Save Images widget\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Related:\"\n      }), \" \", _jsx(LinkNew, {\n        url: \"/blog/2017/04/03/image-analytics-clustering/\",\n        name: \"Image Analytics: Clustering\"\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Training the model to sort images\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Image Grid is excellent to discover similar images. Still, it is not practical to sort photos into category groups. If we would like to do that more often, we would always need to assign images to groups manually. Can we have a pipeline that would allow us to make a model that we can reuse later when we take new photos s?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Related\"\n      }), \": \", _jsx(LinkNew, {\n        url: \"https://www.youtube.com/watch?v=lvgx62a8XQk&list=PLmNPvQr9Tf-aRstY69vGAPO_c5RaceBhN&index=1&ab_channel=OrangeDataMining\",\n        name: \"Video on image classification\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can train a classification model that will mark images with categories.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We prepared a separate training dataset with pictures in 5 subfolders. Folders are named: city, food, mountains, sunsets and winter. Names of the folders define categories; once the model is trained, it will always classify images in those categories.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We will first test how accurate the model is.\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-test-and-score.jpg\",\n      width: \"700\",\n      height: \"342\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-test-and-score.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/importimages/\",\n        children: \"The Import Images\"\n      }), \" widget loads images from the training dataset (\", _jsx(_components.a, {\n        href: \"https://github.com/PrimozGodec/datasets/raw/master/image-analytics-collection/train-photos.zip\",\n        children: \"download the training data\"\n      }), \"). Since images are sorted in multiple folders, the widget assigns the folder name to images as a category, which we can see in the Data Table. We embed images with Inception v3 embedder in \", _jsx(_components.a, {\n        href: \"/blog/2022-02-edit-image-collection/(/widget-catalog/image-analytics/imageembedding/)\",\n        children: \"the Image Embedding widget\"\n      }), \" and performs cross-validation in \", _jsx(_components.a, {\n        href: \"/widget-catalog/evaluate/testandscore\",\n        children: \"the Test and Score widget\"\n      }), \". The model we use is logistic regression. We are happy with the model with AUC 0.992 and classification accuracy of 0.943.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now we can train the model that will be used to label an unlabeled set of photos.\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-classification.jpg\",\n      width: \"700\",\n      height: \"492\",\n      src: \"/blog/2022-02-edit-image-collection/2022-02-11-image-classification.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We train \", _jsx(_components.a, {\n        href: \"/widget-catalog/model/logisticregression\",\n        children: \"the logistic regression model\"\n      }), \" on the training images in the top branch on the labelled training dataset. Data that we want to label (sort in subfolders) are loaded and embedded in the bottom branch. We use \", _jsx(_components.a, {\n        href: \"https://github.com/PrimozGodec/datasets/blob/master/image-analytics-collection/test-photos.zip\",\n        children: \"the same images\"\n      }), \" as in the first part of the blog. \", _jsx(_components.a, {\n        href: \"/widget-catalog/evaluate/predictions\",\n        children: \"The Predictions widget\"\n      }), \" assigns labels to the images based on the logistic regression model.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We use \", _jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/imageviewer\",\n        children: \"the Image Viewer\"\n      }), \" to inspect assigned labels to images. Labels seem to be meaningful and correct. Now that we have photos labelled, we save them to the folder structure with \", _jsx(_components.a, {\n        href: \"/widget-catalog/image-analytics/saveimages\",\n        children: \"the Save Images widget\"\n      }), \" such that each folder is one category. Since the Prediction widget places predictions (column named Logistic Regression) in the meta part of the table, we need to first set the attribute as a target with the Select Columns widget --- the Save Images widget uses the target column as a subfolder name.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We also connected \", _jsx(_components.a, {\n        href: \"/widget-catalog/model/savemodel\",\n        children: \"the Save Model widget\"\n      }), \" to the Logistic Regression. This way, the model is saved for later and can be reused.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Want to learn more?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We showed two ways of analysing images with Orange's Image Analytics module. The Image Grid is a great tool to identify similar images and see them in the grid. The second one needs an extra effort to prepare a training dataset, but this leads to an automatic pipeline to identify categories.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you want to learn more about Image Analysis in Orange \", _jsx(_components.a, {\n        href: \"https://youtube.com/playlist?list=PLmNPvQr9Tf-aRstY69vGAPO_c5RaceBhN\",\n        children: \" watch the tutorial wideos\"\n      }), \" or read related blogs: \", _jsx(_components.a, {\n        href: \"/blog/2017/04/03/image-analytics-clustering/%5D\",\n        children: \"Image Analytics: Clustering\"\n      }), \", \", _jsx(_components.a, {\n        href: \"/blog/2018/05/09/clustering-of-monet-and-manet/\",\n        children: \"Clustering of Monet and Manet\"\n      }), \", and \", _jsx(_components.a, {\n        href: \"/blog/2017/04/25/outliers-in-traffic-signs/\",\n        children: \"Outliers in Traffic Signs\"\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true}