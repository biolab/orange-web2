{"pageProps":{"frontmatter":{"author":"Ajda Pretnar","date":"2020-07-27","draft":false,"title":"Detecting Story Arcs with Orange","type":"blog","thumbImage":"2020-07-27-story-arcs-small.png","frontPageImage":"2020-07-27-story-arcs-small.png","blog":["text mining","sentiment analysis","corpus","story arc","heat map","line chart"],"shortExcerpt":"How to detect and analyze story arcs in a corpus.","longExcerpt":"How to detect sentiment, plot story arcs and analyze the key segments in a corpus.","x2images":false,"aliases":["/blog/2021/2021-04-16-story-arcs/"]},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    strong: \"strong\",\n    em: \"em\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\"\n  }, _provideComponents(), props.components), {LinkNew, WindowScreenshot, WorkflowScreenshot} = _components;\n  if (!LinkNew) _missingMdxReference(\"LinkNew\", true);\n  if (!WindowScreenshot) _missingMdxReference(\"WindowScreenshot\", true);\n  if (!WorkflowScreenshot) _missingMdxReference(\"WorkflowScreenshot\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Reading is fun because it takes you on a journey. Mostly, it is a journey of emotions as you live and breathe with the protagonist and her adventures. Today, we will have a look at how to detect sentiment in a story, plot story arcs and analyze the content of the key segments in a corpus.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Related: \", _jsx(LinkNew, {\n        url: \"/blog/2018/09/11/text-workshops-in-ljubljana/\",\n        name: \"Text Workshops in Ljubljana\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We will be using a corpus of Anderson's tales, which is available in the \", _jsx(_components.strong, {\n        children: \"Corpus\"\n      }), \" widget (data set \", _jsx(_components.em, {\n        children: \"anderson.tab\"\n      }), \"). Load it in the widget. Next, we will select a single tale which we will analyze, say, Little Match Seller. Connect Corpus to \", _jsx(_components.strong, {\n        children: \"Data Table\"\n      }), \" and select the tale. We all know the story of a little girl selling matches on a New Year's Eve and freezing to death. It is one of the saddest stories ever told. One could almost forget there are positive parts, such as the girl's visions in the moments before her death, which show a glimmer of hope, the only consolation the girl had in her life. Let us verify this in Orange.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-corpus.png\",\n      width: \"454\",\n      height: \"336\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-corpus.webp\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-data-table.png\",\n      width: \"513\",\n      height: \"192\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-data-table.webp\"\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-wf1.png\",\n      width: \"246\",\n      height: \"98\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-wf1.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"With our story selected, we have to split it into sentences. At the moment, our story is a single row in the data, but we wish to have each sentence in its own row. We will use \", _jsx(_components.strong, {\n        children: \"Preprocess Text\"\n      }), \" and select Sentence tokenization. I have removed the redundant preprocessors and kept the only one we need.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-preprocess.png\",\n      width: \"569\",\n      height: \"526\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-preprocess.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Some Python magic will help us create a new corpus from the existing tokens (sentences). Copy and paste the script below into the \", _jsx(_components.strong, {\n        children: \"Python Script\"\n      }), \" widget. Do not forget to press \", _jsx(_components.strong, {\n        children: \"Run\"\n      }), \" once you have pasted the script into the widget.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        children: \"    import numpy as np\\n    from Orange.data import Domain, StringVariable\\n    from orangecontrib.text.corpus import Corpus\\n\\n    tokens = in_data.tokens\\n    new_domain = Domain(attributes=[], metas=[StringVariable('Sentences'), StringVariable('Title')])\\n\\n    titles = []\\n    content = []\\n\\n    for i, doc in enumerate(tokens):\\n        for t in doc:\\n            titles.append(in_data[i]['Title'].value)\\n            content.append(t)\\n\\n    metas = np.column_stack((content, titles))\\n    out_data = Corpus.from_numpy(domain=new_domain, X=np.empty((len(content), 0)),\\n                                metas=metas)\\n    out_data.set_text_features([StringVariable('Sentences')])\\n\"\n      })\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-wf2.png\",\n      width: \"556\",\n      height: \"109\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-wf2.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Perfect, our data is now ready for the final step. Add another Preprocess Text and keep the default preprocessors. They will lowercase our sentences, split by words and remove English stopwords.\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-preprocess2.png\",\n      width: \"735\",\n      height: \"571\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-preprocess2.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Finally, add the \", _jsx(_components.strong, {\n        children: \"Sentiment Analysis\"\n      }), \" widget. By default, the widget uses the Vader algorithm, which works quite well for English. Please note that it won't work for other languages, as all of Orange's sentiment models are language specific. You can use Multilingual sentiment for non-English texts.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-sentiment-analysis.png\",\n      width: \"402\",\n      height: \"249\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-sentiment-analysis.webp\"\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-wf3.png\",\n      width: \"853\",\n      height: \"110\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-wf3.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"At last, it is time to analyze the data. We will use \", _jsx(_components.a, {\n        href: \"https://github.com/biolab/orange3-timeseries\",\n        children: \"Timeseries add-on\"\n      }), \" to plot sequential data. First, we will pass the data to the \", _jsx(_components.strong, {\n        children: \"As Timeseries\"\n      }), \" widget and set the \", _jsx(_components.em, {\n        children: \"Sequence implied by the instance order\"\n      }), \" option. This tells Orange that our data is already ordered by time - in our case, by the order in which each sentence appears in the story.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-as-timeseries.png\",\n      width: \"297\",\n      height: \"225\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-as-timeseries.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Connect \", _jsx(_components.strong, {\n        children: \"Line Chart\"\n      }), \" to As Timeseries. In the widget, select \", _jsx(_components.em, {\n        children: \"Compound\"\n      }), \" variable, which shows the total sentiment of each sentence. The peaks represent the parts of the story with positive emotions and the drops the parts with the negative ones.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-line-chart.png\",\n      width: \"891\",\n      height: \"327\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-line-chart.webp\"\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-wf4.png\",\n      width: \"574\",\n      height: \"107\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-wf4.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To explore the data in depth, connect \", _jsx(_components.strong, {\n        children: \"Heat Map\"\n      }), \" to Sentiment Analysis. Heat Map will show all 4 sentiment attributes, namely positive (pos), negative (neg), neutral (neu) and   compound sentiment. But our data is all over the place. Let us order it. Select \", _jsx(_components.em, {\n        children: \"Clustering (opt. ordering)\"\n      }), \" under the Clustering - Rows option. This will cluster the sentences by their similarity, specifically by how similar their emotion is.\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-heat-map.png\",\n      width: \"569\",\n      height: \"757\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-heat-map.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Great! Now this looks like something useful. The blue sections represent the negative sentences, while the yellow and white sections represent the positive ones. Let us select the cluster with negative sentences and observe it in a \", _jsx(_components.strong, {\n        children: \"Corpus Viewer\"\n      }), \".\"]\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-negative-sentiment.png\",\n      width: \"733\",\n      height: \"635\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-negative-sentiment.webp\"\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-wf5.png\",\n      width: \"423\",\n      height: \"205\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-wf5.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I have set Sentences as the single Display variable and selected all the sentences to show them in a list. Unsurprisingly, here is the last sentence of the story, in which a girl if found dead in the street on a New Year's Day.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"To finish, let us explore the positive sentences, too. Select the positive section in the Heat Map and observe it in a Corpus Viewer. Now rethink the story, reread her visions in the last moments of her life and how happy she was when she died. Couldn't we say that ... the story has a happy ending?\"\n    }), \"\\n\", _jsx(WindowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-positive-sentiment.png\",\n      width: \"733\",\n      height: \"635\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-positive-sentiment.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"While the workflow is quite long, it is conceptually very simple. This is a quick and easy way to explore the story arcs and sentiment in a text. We imagine this to be a very useful tool for the teachers who wish to experiment a bit in their language classes and offer a fun and fruitful way of exploring literature.\"\n    }), \"\\n\", _jsx(WorkflowScreenshot, {\n      src: \"/blog/2020-07-story-arcs/2020-07-27-final-workflow.png\",\n      width: \"2306\",\n      height: \"440\",\n      src: \"/blog/2020-07-story-arcs/__webp-images__/2020-07-27-final-workflow.webp\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true}